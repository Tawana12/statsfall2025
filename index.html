<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solar Activity vs Temperature – Dashboard</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- noUiSlider -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css">
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}

.container {
    max-width: 1200px;
    margin: auto;
}

/* Tabs */
.tab-container {
    margin-top: 20px;
}

.tab-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.tab-buttons button {
    padding: 10px 16px;
    border: 1px solid #ccc;
    background: #eee;
    cursor: pointer;
}

.tab-buttons button.active {
    background: #ddd;
    font-weight: bold;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Charts */
.chart-wrapper {
    width: 90%;
    max-width: 900px;
    margin: 0 auto 40px auto;
}

canvas {
    width: 100% !important;
    height: 420px !important;
    display: block;
    margin: 0 auto;
}

.summary-boxes {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin: 20px 0;
}

.summary-box {
    flex: 1 1 30%;
    padding: 12px;
    border: 1px solid #ccc;
    background: #fafafa;
}

.summary-label {
    font-weight: bold;
}

#slider {
    width: 90%;
    max-width: 900px;
    margin: 20px auto;
}

.download-box {
    border: 1px solid #ccc;
    background: #fafafa;
    padding: 15px;
    margin-top: 20px;
}

.download-box ul {
    margin: 0;
    padding-left: 20px;
}

/* Notebook iframe */
#notebookFrame {
    width: 100%;
    height: 900px;
    border: 1px solid #ccc;
}
</style>
</head>

<body>
<div class="container">

<h1>Solar Activity & Global Temperature Dashboard</h1>

<!-- TABS -->
<div class="tab-container">

    <div class="tab-buttons">
        <button class="active" onclick="openTab('dashboard')">Dashboard</button>
        <button onclick="openTab('notebook')">Notebook Viewer</button>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="dashboard" class="tab-content active">

        <!-- DOWNLOAD SECTION -->
        <h3>Download Data & Notebook</h3>
        <div class="download-box">
          <ul>
            <li><a href="Sunspots.csv" download>Download Sunspots CSV</a></li>
            <li><a href="TSI.csv" download>Download TSI CSV</a></li>
            <li><a href="Temperatures.csv" download>Download Temperatures CSV</a></li>
            <li><a href="Final Notebook.ipynb" download>Download Final Notebook (.ipynb)</a></li>
          </ul>
        </div>

        <h3>Select Year Range</h3>
        <div id="slider"></div>
        <div id="rangeText" style="margin-top:10px; font-weight:bold;"></div>

        <div class="summary-boxes">
            <div class="summary-box">
                <span class="summary-label">Average Sunspots (count)</span><br>
                <span id="avgSun">–</span>
            </div>
            <div class="summary-box">
                <span class="summary-label">Average TSI (W/m²)</span><br>
                <span id="avgTSI">–</span>
            </div>
            <div class="summary-box">
                <span class="summary-label">Average Temperature Anomaly (°C)</span><br>
                <span id="avgTemp">–</span>
            </div>
        </div>

        <h2>Sunspots Over Time (count)</h2>
        <div class="chart-wrapper">
            <canvas id="sunChart"></canvas>
        </div>

        <h2>Total Solar Irradiance Over Time (W/m²)</h2>
        <div class="chart-wrapper">
            <canvas id="tsiChart"></canvas>
        </div>

        <h2>Temperature Anomalies Over Time (°C)</h2>
        <div class="chart-wrapper">
            <canvas id="tempChart"></canvas>
        </div>

        <h2>Combined Comparison (scaled)</h2>
        <div class="chart-wrapper">
            <canvas id="combinedChart"></canvas>
        </div>

        <h2>Temperature Anomaly vs Sunspots</h2>
        <div class="chart-wrapper">
            <canvas id="scatterSun"></canvas>
        </div>

        <h2>Temperature Anomaly vs TSI (W/m²)</h2>
        <div class="chart-wrapper">
            <canvas id="scatterTSI"></canvas>
        </div>

    </div>

    <!-- NOTEBOOK TAB -->
    <div id="notebook" class="tab-content">
        <h2>Notebook Viewer</h2>
        <iframe id="notebookFrame"
                src="https://nbviewer.org/github/Tawana12/statsfall2025/blob/main/Final%20Notebook.ipynb">
        </iframe>
    </div>

</div>

</div>

<script>
// TAB SWITCHING
function openTab(tabName) {
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));

    document.getElementById(tabName).classList.add("active");
    event.target.classList.add("active");
}

// CSV PARSER
function csvToRows(text) {
    const lines = text.trim().split(/\r?\n/);
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
        const cols = line.split(',');
        let obj = {};
        headers.forEach((h, i) => obj[h] = cols[i]);
        return obj;
    });
}

let yearly = {};
let years = [];
let charts = {};

Promise.all([
    fetch("Sunspots.csv").then(r => r.text()),
    fetch("TSI.csv").then(r => r.text()),
    fetch("Temperatures.csv").then(r => r.text())
]).then(([sunText, tsiText, tempText]) => {

    let sun = csvToRows(sunText);
    let tsi = csvToRows(tsiText);
    let temp = csvToRows(tempText);

    processData(sun, tsi, temp);
    setupSlider();
    updateDashboard();

});

// PROCESS DATA
function processData(sun, tsi, temp) {
    const full = ["January","February","March","April","May","June",
                  "July","August","September","October","November","December"];
    const short = ["Jan","Feb","Mar","Apr","May","Jun",
                   "Jul","Aug","Sep","Oct","Nov","Dec"];

    sun.forEach(r => {
        if (!r.Year) return;
        let yr = r.Year;
        yearly[yr] = yearly[yr] || {};
        yearly[yr].sun = full.map(m => parseFloat(r[m]) || 0)
                             .reduce((a,b)=>a+b)/12;
    });

    tsi.forEach(r => {
        let yr = r.Year;
        if (!yr || !yearly[yr]) return;
        yearly[yr].tsi = full.map(m => parseFloat(r[m]) || 0)
                             .reduce((a,b)=>a+b)/12;
    });

    temp.forEach(r => {
        let yr = r.Year;
        if (!yr || !yearly[yr]) return;
        yearly[yr].temp = short.map(m => parseFloat(r[m]) || 0)
                               .reduce((a,b)=>a+b)/12;
    });

    years = Object.keys(yearly)
                  .filter(y => yearly[y].sun && yearly[y].tsi && yearly[y].temp)
                  .sort((a,b)=>a-b);
}

// SLIDER
function setupSlider() {
    let slider = document.getElementById("slider");

    noUiSlider.create(slider, {
        start: [years[0], years[years.length-1]],
        connect: true,
        step: 1,
        orientation: "horizontal",
        range: {
            min: parseInt(years[0]),
            max: parseInt(years[years.length-1])
        },
        tooltips: true,
        format: {
            from: Number,
            to: value => Math.round(value)
        }
    });

    slider.noUiSlider.on("update", updateDashboard);
}

// UPDATE DASHBOARD
function updateDashboard() {
    let [start, end] = document.getElementById("slider").noUiSlider.get();
    start = parseInt(start);
    end   = parseInt(end);

    document.getElementById("rangeText").innerText =
        `Showing ${start} – ${end}`;

    let filteredYears = years.filter(y => y >= start && y <= end);

    let sun = filteredYears.map(y => yearly[y].sun);
    let tsi = filteredYears.map(y => yearly[y].tsi);
    let temp = filteredYears.map(y => yearly[y].temp);

    document.getElementById("avgSun").innerText =
        (sun.reduce((a,b)=>a+b)/sun.length).toFixed(2);

    document.getElementById("avgTSI").innerText =
        (tsi.reduce((a,b)=>a+b)/tsi.length).toFixed(3);

    document.getElementById("avgTemp").innerText =
        (temp.reduce((a,b)=>a+b)/temp.length).toFixed(3);

    drawCharts(filteredYears, sun, tsi, temp);
}

// CHART DRAWING
function destroy(id) { if (charts[id]) charts[id].destroy(); }

function drawCharts(lbls, sun, tsi, temp) {

    destroy("sun");
    charts.sun = new Chart(document.getElementById("sunChart"), {
        type: "line",
        data: { labels: lbls, datasets: [{ 
            label:"Sunspots (count)", 
            data:sun, 
            borderColor:"orange" 
        }] }
    });

    destroy("tsi");
    charts.tsi = new Chart(document.getElementById("tsiChart"), {
        type: "line",
        data: { labels: lbls, datasets: [{ 
            label:"TSI (W/m²)",
            data:tsi, 
            borderColor:"green"
        }] }
    });

    destroy("temp");
    charts.temp = new Chart(document.getElementById("tempChart"), {
        type: "line",
        data: { labels: lbls, datasets: [{ 
            label:"Temperature Anomaly (°C)", 
            data:temp, 
            borderColor:"red"
        }] }
    });

    destroy("combined");
    charts.combined = new Chart(document.getElementById("combinedChart"), {
        type: "line",
        data: {
            labels: lbls,
            datasets: [
                { label:"Sunspots (÷10)", data: sun.map(v=>v/10), borderColor:"orange"},
                { label:"TSI (−1360 W/m²)", data: tsi.map(v=>v-1360), borderColor:"green"},
                { label:"Temperature Anomaly (°C)", data: temp, borderColor:"red"}
            ]
        }
    });

    destroy("scatterSun");
    charts.scatterSun = new Chart(document.getElementById("scatterSun"), {
        type: "scatter",
        data: { datasets: [{
            label:"Temp Anomaly (°C) vs Sunspots",
            data: lbls.map((y,i)=>({x:sun[i],y:temp[i]})),
            backgroundColor:"orange"
        }] }
    });

    destroy("scatterTSI");
    charts.scatterTSI = new Chart(document.getElementById("scatterTSI"), {
        type: "scatter",
        data: { datasets: [{
            label:"Temp Anomaly (°C) vs TSI (W/m²)",
            data: lbls.map((y,i)=>({x:tsi[i],y:temp[i]})),
            backgroundColor:"blue"
        }] }
    });
}

</script>

</body>
</html>
